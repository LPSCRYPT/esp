Example ESP implementation for DxDAO

Users have a certain amount of points which they can use to signal on a string-indexed signal.

Users and their points values are hardcoded by stream owners.

Emitted events must have all relevant information in their `bytes value`:

1. StreamID
2. User emitting event
3. Total points of user
4. Points user has (de)signalled
5. String to which (de)signalling has occured
6. If user is adding or withdrawing points in this transaction

georli deployment
World
worldAddress 0x5EF8AFa3DE8CAEdfa336Ea6D96328e5fb932F65C
SignalRouterSystem
routerAddress 0x44Fec79BaA6f6f9865bc61CB3566b56A57679A4e
StreamMemberIndexComponent
smicAddress 0x689eeBE6e8174D1C2cdC4d07554655f17cd74D46
TopLevelSystemIndexComponent
tlsicAddress 0x68Cb471baDd0788c485FE2B40de2A35BAe45834d
StreamSystemIndexComponent
ssicAddress 0xEF21401Fe75e7361d28bf723b204f4CFAd514A63
StreamOwnerRegistry
sorAddress 0x4658734bd2FD52468a964F0ACaDE68B6F78F0479
DxDMemberPointsRegistry
DxDmprAddress 0x104D7e73ba2CF955A813da67c37f5631aFc89619
DxDMemberRegistrySystem
DxDmrsAddress 0x9E058C762547455eEB80e1460f47dB503c60c997
DxDMemberAvailablePointsComponent
DxDmapcAddress 0xF1842A7cf7412629C8fc0FD1845c8AF5e7b105A3
DxDSignalStoreComponent
DxDsscAddress 0x58A669942102665595EeDFC9AF7b98A3F0B147b6
DxDMemberPointsSystem
DxDmpsAddress 0x1Ee7B1baAAC58b05c84EBE42aBFf6bDE5Aa504d9

cast send 0x104D7e73ba2CF955A813da67c37f5631aFc89619 "addUsers(uint256,uint256[],address[])" 1 "[100]" "[0xED1144847Ec1a08Fca702bDC4d6fb0a9c828F2d5]" --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY

cast send 0x4658734bd2FD52468a964F0ACaDE68B6F78F0479 "streamRegister(uint256,address[])" 1 "[0x5ceb0a73C8e436315830cd64b3dA7d8404a1ceD7]" --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY

cast send --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY 0x44Fec79BaA6f6f9865bc61CB3566b56A57679A4e "execute(bytes)" 0x00000000000000000000000000000000000000000000000000000000000000010000000000000000000000001ee7b1baaac58b05c84ebe42abff6bde5aa504d9000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000004646f676500000000000000000000000000000000000000000000000000000000

forge script src/esp-contracts/examples/DxDAO/script/DxDSignalScript.s.sol:DxDSignalScript --rpc-url $GOERLI_RPC_URL --broadcast

cast send --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY 0x44Fec79BaA6f6f9865bc61CB3566b56A57679A4e "execute"

cast send --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY 0x104D7e73ba2CF955A813da67c37f5631aFc89619 "addUsers(uint256,uint256[],address[])" 1 "[100]" "[0x5ceb0a73C8e436315830cd64b3dA7d8404a1ceD7]"

cast call --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY 0x4658734bd2FD52468a964F0ACaDE68B6F78F0479 "validOwner(uint256,address)" 1 0x5ceb0a73C8e436315830cd64b3dA7d8404a1ceD7

abi-encode "execute()"

cast --chain estimate 0x104D7e73ba2CF955A813da67c37f5631aFc89619 "addUsers()(uint256[],address[])" "[1]" "[0xED1144847Ec1a08Fca702bDC4d6fb0a9c828F2d5]"

cast call --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY 0x104D7e73ba2CF955A813da67c37f5631aFc89619 "getUserPoints(uint256,address)" 1 0x5ceb0a73C8e436315830cd64b3dA7d8404a1ceD7

cast call --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY 0xF1842A7cf7412629C8fc0FD1845c8AF5e7b105A3 "getValue(uint256)" 80233901236022004132281809751570228949350968616980246140348755947396907904581

0x00000000000000000000000000000000000000000000000000000000000000010000000000000000000000001ee7b1baaac58b05c84ebe42abff6bde5aa504d9000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000047065706500000000000000000000000000000000000000000000000000000000

stonerocks$ forge verify-contract --constructor-args $(cast abi-encode "constructor(address)" 0x4658734bd2FD52468a964F0ACaDE68B6F78F0479) 0x104D7e73ba2CF955A813da67c37f5631aFc89619 DxDAOMemberPointsRegistry .src/esp-contracts/examples/DxDAO/DxDAOMemberPointsRegistry.sol:DxDAOMemberPointsRegistry $ETHERSCAN_KEY

https://rpc.ankr.com/eth_goerli

oustanding issues:
cannot verify contracts on etherscan do to multiple identical inherited imports
cannot call certain state mutating functions
comparison sign switched in dxdmrs, needs redeployment to add new stream owners
